<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vapi Test - Attar Travel</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            max-width: 600px;
            width: 100%;
            background: white;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
            text-align: center;
        }
        
        h1 {
            color: #14B8A6;
            font-size: 2.5em;
            margin-bottom: 20px;
        }
        
        .status {
            background: #f3f4f6;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 14px;
            text-align: left;
        }
        
        .error {
            background: #fee;
            color: #c00;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .success {
            background: #efe;
            color: #0a0;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        button {
            background: #14B8A6;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin: 10px;
        }

        button:hover {
            background: #0d9488;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé§ Vapi Test Widget</h1>
        <p>Testing Vapi connection and configuration</p>
        
        <div id="status" class="status">
            Initializing...
        </div>

        <button onclick="testConnection()">Test Connection</button>
        <button onclick="startCall()">Start Call</button>
    </div>

    <!-- Vapi Widget -->
    <vapi-widget
        id="vapi-widget"
        public-key="577ae6b3-53b9-4a37-b6f6-74e8e8808368"
        assistant-id="e1c04a87-a8cf-4438-a91b-5888f69d1ef2"
        mode="voice"
        theme="dark"
        accent-color="#14B8A6"
        position="bottom-right"
    ></vapi-widget>

    <script src="https://unpkg.com/@vapi-ai/client-sdk-react/dist/embed/widget.umd.js" async type="text/javascript"></script>

    <script>
        const statusEl = document.getElementById('status');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#c00' : type === 'success' ? '#0a0' : '#333';
            statusEl.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            statusEl.scrollTop = statusEl.scrollHeight;
        }

        // Listen for Vapi events
        window.addEventListener('message', (event) => {
            if (!event.data) return;
            
            const data = event.data;
            
            // Log all events
            if (data.type === 'vapi-message') {
                log(`Vapi event: ${data.message?.type || 'unknown'}`, 'success');
            }
            
            // Check for errors
            if (data.action === 'start-method-error' || data.type === 'error') {
                log(`ERROR: ${JSON.stringify(data)}`, 'error');
                
                // Show user-friendly error
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error';
                errorDiv.innerHTML = `
                    <strong>‚ö†Ô∏è Connection Failed</strong><br>
                    <br>
                    Possible issues:<br>
                    1. Assistant not enabled for web calls<br>
                    2. Public key or Assistant ID incorrect<br>
                    3. Assistant not fully configured<br>
                    <br>
                    <strong>Fix:</strong> Check Vapi dashboard settings
                `;
                document.querySelector('.container').appendChild(errorDiv);
            }
            
            // Log successful connection
            if (data.type === 'vapi-message' && data.message?.type === 'call-start') {
                const successDiv = document.createElement('div');
                successDiv.className = 'success';
                successDiv.textContent = '‚úÖ Connected! Voice call active!';
                document.querySelector('.container').appendChild(successDiv);
            }
        });

        async function testConnection() {
            log('Testing Vapi configuration...', 'info');
            
            const publicKey = '577ae6b3-53b9-4a37-b6f6-74e8e8808368';
            const assistantId = 'e1c04a87-a8cf-4438-a91b-5888f69d1ef2';
            
            log(`Public Key: ${publicKey}`, 'info');
            log(`Assistant ID: ${assistantId}`, 'info');
            
            try {
                // Try to ping Vapi API
                const response = await fetch('https://api.vapi.ai/assistant/' + assistantId, {
                    headers: {
                        'Authorization': 'Bearer ' + publicKey
                    }
                });
                
                if (response.ok) {
                    log('‚úÖ Assistant exists and is accessible', 'success');
                    const data = await response.json();
                    log(`Assistant name: ${data.name || 'Unknown'}`, 'success');
                } else if (response.status === 401) {
                    log('‚ùå Public key is invalid', 'error');
                } else if (response.status === 404) {
                    log('‚ùå Assistant ID not found', 'error');
                } else {
                    log(`‚ùå API returned: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`‚ùå Test failed: ${error.message}`, 'error');
            }
        }

        function startCall() {
            log('Attempting to start call...', 'info');
            
            // Try to trigger the widget
            const widget = document.getElementById('vapi-widget');
            if (widget) {
                // Simulate click on start button
                const shadow = widget.shadowRoot;
                if (shadow) {
                    const startBtn = shadow.querySelector('button');
                    if (startBtn) {
                        startBtn.click();
                        log('Widget start button clicked', 'info');
                    }
                }
            }
        }

        // Auto-test on load
        setTimeout(() => {
            log('Page loaded. Ready to test.', 'success');
            log('Click "Test Connection" to verify setup', 'info');
        }, 1000);
    </script>
</body>
</html>

